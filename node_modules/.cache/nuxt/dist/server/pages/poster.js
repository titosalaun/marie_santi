exports.ids = [9];
exports.modules = {

/***/ 55:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// CONCATENATED MODULE: ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@nuxt/components/dist/loader.js??ref--0-0!./node_modules/vue-loader/lib??vue-loader-options!./pages/poster.vue?vue&type=template&id=a3967356&scoped=true&
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"container"},[_vm._ssrNode("<div class=\"content\" data-v-a3967356>","</div>",[_vm._ssrNode("<div class=\"col-left\" data-v-a3967356>","</div>",[_vm._ssrNode("<div class=\"logo\" data-v-a3967356>","</div>",[_c('nuxt-link',{attrs:{"to":"/"}},[_c('svg',{attrs:{"id":"Calque_1","data-name":"Calque 1","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 776.86 861.5"}},[_c('path',{attrs:{"d":"M291.29,701.18c0,92.18,68.41,131,165.81,131,112.47,0,162.9-51,162.9-163.49V558.56H444.92C360.86,558.56,291.29,614.22,291.29,701.18ZM151.57,725.53c0-113,68.41-197.69,176.24-208.13V490.15c-84.06-10.43-146.67-87-146.67-179.14,0-133.34,130.44-215.66,280-215.66C622.9,95.35,740,173,747,332.46H611.89c-7-80-60.87-117.1-149-117.1-83.48,0-141.45,38.84-141.45,114.78s55.65,117.11,139.14,117.11H928.43V558.56H755.08c0,266.11-3.47,265,5.8,273.64,8.12,7.54,11.6,5.22,167.55,5.22V945.25c-207.55,0-224.94,5.8-263.21-34.2-22.61-23.77-21.45-74.79-21.45-74.79H622.9c-34.78,86.38-107.83,120.59-203.49,120.59C265.2,956.85,151.57,877.42,151.57,725.53Z","transform":"translate(-151.57 -95.35)"}})])])],1),_vm._ssrNode(" "),_vm._ssrNode("<div class=\"tools\" data-v-a3967356>","</div>",[_vm._ssrNode("<div"+(_vm._ssrClass("tools-content",{ open: _vm.isTools }))+" data-v-a3967356>","</div>",[_vm._ssrNode("<div data-v-a3967356>","</div>",[_vm._ssrNode("<label class=\"big\" data-v-a3967356>Couleur</label> "),_vm._ssrNode("<div class=\"zoneColorText\" data-v-a3967356>","</div>",[_c('color-picker',{on:{"change":_vm.updateColorText},model:{value:(_vm.color_text),callback:function ($$v) {_vm.color_text=$$v},expression:"color_text"}})],1)],2),_vm._ssrNode(" "),_vm._ssrNode("<div data-v-a3967356>","</div>",[_vm._ssrNode("<label class=\"big\" data-v-a3967356>Fond</label> "),_vm._ssrNode("<div class=\"zoneColorBg\" data-v-a3967356>","</div>",[_c('color-picker',{on:{"change":_vm.updateColorBg},model:{value:(_vm.color_bg),callback:function ($$v) {_vm.color_bg=$$v},expression:"color_bg"}})],1)],2),_vm._ssrNode(" <div data-v-a3967356><label data-v-a3967356>"+_vm._ssrEscape("Taille de la font : "+_vm._s(_vm.font_size))+"</label> <input type=\"range\" id=\"font_size\" min=\"10\" max=\"200\""+(_vm._ssrAttr("value",(_vm.font_size)))+" class=\"slider\" data-v-a3967356></div> <div data-v-a3967356><label data-v-a3967356>"+_vm._ssrEscape("Interlettrage : "+_vm._s(_vm.interlettrage))+"</label> <input type=\"range\" id=\"interlettrage\" min=\"0\" max=\"40\""+(_vm._ssrAttr("value",(_vm.interlettrage)))+" class=\"slider\" data-v-a3967356></div> <div data-v-a3967356><label data-v-a3967356>"+_vm._ssrEscape("Interlignage : "+_vm._s(_vm.interlignage))+"</label> <input type=\"range\" id=\"interlignage\" min=\"10\" max=\"200\""+(_vm._ssrAttr("value",(_vm.interlignage)))+" class=\"slider\" data-v-a3967356></div> <div data-v-a3967356><label data-v-a3967356>"+_vm._ssrEscape("Décibels : "+_vm._s(_vm.decibel))+"</label> <input type=\"range\" step=\"0.0001\" id=\"decibel\" min=\"-0.1\" max=\"0\""+(_vm._ssrAttr("value",(_vm.decibel)))+" class=\"slider\" data-v-a3967356></div> <div data-v-a3967356><button class=\"cursor-pointer toGalerie\" data-v-a3967356>Play</button></div> <div data-v-a3967356><button class=\"cursor-pointer toGalerie\" data-v-a3967356>Galerie</button></div> <div data-v-a3967356><button class=\"cursor-pointer toPoster\" data-v-a3967356>Export JPG</button></div>")],2)])],2),_vm._ssrNode(" <div"+(_vm._ssrClass("col-content",{ marge: _vm.isTools }))+" data-v-a3967356><div class=\"col-content-list\" data-v-a3967356><div class=\"item flex-col\" data-v-a3967356><div class=\"block text-center w-full\""+(_vm._ssrStyle(null,null, { display: (_vm.isShowLoading) ? '' : 'none' }))+" data-v-a3967356>Chargement du poster...</div> <div id=\"p5Canvas_99\" class=\"canvas-area flex justify-center w-full\" data-v-a3967356></div></div></div></div>")],2)])}
var staticRenderFns = []


// CONCATENATED MODULE: ./pages/poster.vue?vue&type=template&id=a3967356&scoped=true&

// EXTERNAL MODULE: external "core-js/modules/esnext.string.replace-all.js"
var esnext_string_replace_all_js_ = __webpack_require__(41);

// EXTERNAL MODULE: external "vuex"
var external_vuex_ = __webpack_require__(3);

// EXTERNAL MODULE: external "axios"
var external_axios_ = __webpack_require__(5);
var external_axios_default = /*#__PURE__*/__webpack_require__.n(external_axios_);

// EXTERNAL MODULE: external "tone"
var external_tone_ = __webpack_require__(37);

// EXTERNAL MODULE: external "moment"
var external_moment_ = __webpack_require__(38);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib??ref--2-0!./node_modules/@nuxt/components/dist/loader.js??ref--0-0!./node_modules/vue-loader/lib??vue-loader-options!./pages/poster.vue?vue&type=script&lang=js&

//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//




var P5;

if (false) { var effet_3, effet_2, effet_1; }

var playerSound;
var bufferSound = new Array();
/* harmony default export */ var postervue_type_script_lang_js_ = ({
  middleware: 'auth',
  computed: { ...Object(external_vuex_["mapGetters"])(['isAuthenticated', 'loggedInfont'])
  },

  created() {
    this.id_message = parseInt(this.$route.query.id);
  },

  mounted() {
    var id = 0;
    localStorage.setItem('id_message', JSON.stringify(id));
    this.parametres = JSON.parse(localStorage.getItem('parametres') || "[]");
    this.getMessage();
    playerSound = new external_tone_["Player"]().toDestination();
    this.meter = new external_tone_["Meter"]({});
    this.initDisplayErreur();
    P5 = __webpack_require__(40);
  },

  data() {
    return {
      script: null,
      ps: null,
      radar: '',
      url_server: this.$store.state.url_server,
      id_user: this.$auth.user.id,
      parametres: '',
      message: [],
      isShowLoading: true,
      isShowNoResult: false,
      timeoutObj: '',
      isTools: false,
      isPause: false,
      myCurrentTimeSave: 0,
      valSetTimeout: 0,
      indexLoad: 0,
      tito: '',
      id_message: 0,
      id_effet: 1,
      texte: '',
      color_text: '',
      color_bg: '',
      font_size: '',
      interlignage: '',
      interlettrage: '',
      isTools: true,
      timeOutTools: 0,
      decibel: 0,
      meter: '',
      isPlayer: false,
      intervalDisplayMic: '',
      mesureVal: 0,
      mesureTps: 0
    };
  },

  methods: {
    getMessage: function () {
      external_axios_default.a.get(this.url_server + "/getMessage?id_message=" + this.id_message).then(response => {
        this.message = response.data.liste;

        if (typeof this.message.texte !== 'undefined') {
          this.id_message = this.message.id_message;
          this.id_effet = this.message.id_effet;
          this.texte = this.message.texte;
          this.color_text = this.message.color_text;
          this.color_bg = this.message.color_bg;
          this.font_size = this.message.font_size;
          this.interlignage = this.message.interlignage;
          this.interlettrage = this.message.interlettrage;
          this.initTools();
          this.loadSound('/upload/message_' + this.id_message + '.webm');
          console.log("font_size : " + this.font_size);
          this.loadMessage(true, this.id_message, this.id_effet, this.texte, this.color_text, this.color_bg, this.font_size, this.interlettrage, this.interlignage, this.decibel);
        }
      }).catch(error => {
        this.id_message = 0;
        displayErreur("Erreur lors du chargement du message : " + error);
      });
    },
    initDisplayErreur: function () {
      hideErreur();
    },
    loadMessage: function (isFirst, id_message, id_effet, message, color_text, color_bg, font_size, interlettrage, interlignage, decibel) {
      console.log("color_text : " + color_text);
      this.ps = null;

      if (!isFirst) {
        document.querySelector('#p5Canvas_99').removeChild(document.querySelector('canvas'));
      }

      this.radar = this.selectEffet(id_effet);
      this.ps = new P5(this.radar.main);
      this.radar.setFctCanvasSize(547, 910);
      this.radar.setFctCanvasId(99);
      this.radar.setFctSound(0);
      this.radar.setFctTextColor(color_text);
      this.radar.setFctBgColor(color_bg);
      this.radar.setFctFontSize(font_size);
      this.radar.setFctInterlettrage(interlettrage);
      this.radar.setFctInterlignage(interlignage);
      message = message.replaceAll('&nbsp;', ' ');
      message = message.replaceAll('\r', '.'); //message  = message.replace(' ','.');

      this.radar.setFctTexte(message, Array.from(message), 0);
      this.radar.setFctDecibel(decibel);
      this.isShowLoading = false;
      document.querySelector('.canvas-area').classList.remove("hidden");
    },
    selectEffet: function (id_effet) {
      if (id_effet == 1) this.radar = effet_1;
      if (id_effet == 2) this.radar = effet_2;
      if (id_effet == 3) this.radar = effet_3;
      return this.radar;
    },
    updateColorText: function () {
      clearTimeout(this.timeOutTools);
      this.timeOutTools = setTimeout(function () {
        this.updateColorPicker(true);
      }.bind(this), 100);
    },
    updateColorBg: function () {
      clearTimeout(this.timeOutTools);
      this.timeOutTools = setTimeout(function () {
        this.updateColorPicker(true);
      }.bind(this), 100);
    },
    updateColorPicker: function (isRadar) {
      if (isRadar) {
        this.loadMessage(false, this.id_message, this.id_effet, this.texte, this.color_text, this.color_bg, this.font_size, this.interlettrage, this.interlignage, this.decibel);
        /*this.radar.setFctTextColor(this.color_text)
        this.radar.setFctBgColor(this.color_bg)
        this.radar.setFctRedraw(this.color_text);*/
        //this.startP5()
        //this.stopP5()
      }

      document.querySelector('.zoneColorText .color-block .value').innerHTML = this.color_text;
      document.querySelector('.zoneColorBg .color-block .value').innerHTML = this.color_bg;
    },
    initTools: function () {
      this.updateColorPicker(false);
    },
    startP5: function () {
      this.radar.startLoopP5();
    },
    stopP5: function () {
      this.radar.stopLoopP5();
    },
    exportPoster: function () {
      this.radar.setFctSave();
    },
    exportGalerie: function () {
      isAction('Exportation du poster en cours...', false);
      var el = document.querySelector(".toGalerie");
      el.classList.add("cursornotallowed");
      el.disabled = true;
      var canvas = document.getElementById("defaultCanvas0");
      var dataURL = canvas.toDataURL("image/png");
      console.log(dataURL); //var base64 = this.resultSound;

      let formData = new FormData();
      formData.append('poster', dataURL);
      formData.append('id_message', this.id_message);
      const timeOutTools = setTimeout(() => {
        external_axios_default.a.post(this.url_server + '/addPoster', formData, {
          headers: {
            'Content-Type': 'multipart/form-data'
          },
          onUploadProgress: function (progressEvent) {//var val = parseInt( Math.round((progressEvent.loaded*100) / progressEvent.total ));
            //document.querySelector('.progress-alert').style.width = val + "px";
            //console.log("progress : " + val)
          }.bind(this)
        }).then(response => {
          //document.querySelector('.progress-alert').style.width = "0px";	
          //this.id_message = response.data.id_message;
          var el = document.querySelector(".toGalerie");
          el.classList.remove("cursornotallowed");
          el.disabled = false;
          isAction('', false);
          displayErreur('Votre poster a été sauvegardé dans la galerie');
        }).catch(err => {
          if (typeof err.response.data.message === 'undefined') displayErreur(err.response.data.message);else displayErreur(err.response.data.message);
        });
      }, 1500);
    },
    goHome: function (id_message) {
      localStorage.setItem('id_message', JSON.stringify(id_message));
      document.location = '/';
    },
    updateFontSize: function () {
      this.loadMessage(false, this.id_message, this.id_effet, this.texte, this.color_text, this.color_bg, this.font_size, this.interlettrage, this.interlignage, this.decibel);
    },
    updateInterlignage: function () {
      this.loadMessage(false, this.id_message, this.id_effet, this.texte, this.color_text, this.color_bg, this.font_size, this.interlettrage, this.interlignage, this.decibel);
      console.log("this.interlignage : " + this.interlignage); //this.radar.setFctInterlignage(this.interlignage)
      //this.radar.setFctRedraw(this.color_text)
    },
    updateInterlettrage: function () {
      console.log("this.interlignage : " + this.interlignage);
      this.loadMessage(false, this.id_message, this.id_effet, this.texte, this.color_text, this.color_bg, this.font_size, this.interlettrage, this.interlignage, this.decibel);
      /*this.radar.setFctTextColor(this.color_text)
      this.radar.setFctBgColor(this.color_bg)
      this.radar.setFctRedraw(this.color_text);*/
      //this.startP5()
      //this.stopP5()
    },

    loadSound(file) {
      bufferSound = new external_tone_["ToneAudioBuffer"]({
        onload: () => {},
        onerror: () => {
          displayErreur("Erreur lors du chargemennt du son associé au poster");
        },
        reverse: false,
        url: file
      });
    },

    playSound() {
      clearInterval(this.intervalDisplayMic);
      playerSound.buffer = bufferSound;
      playerSound.start();
      playerSound.connect(this.meter);
      this.isPlayer = true;
      external_tone_["Transport"].start();
      this.startP5();
      this.intervalDisplayMic = setInterval(() => this.displayVal(this.meter.getValue(), this.meter.getValue()), 100);
    },

    displayVal: function (val, val1) {
      this.index++; //const dBFS = this.meter.getLevel();

      val = val;
      const lowerBound = 0;
      const upperBound = 100; //console.log("val = " + val)
      //console.log("val1 = " + val1)

      val = parseInt(val) + 100;
      this.mesureVal = val;
      this.mesureTps = this.convertSoundDuration(external_tone_["Transport"].getSecondsAtTime());
      this.radar.setFctSound(this.clamp(val) / 8);

      if (playerSound.state == 'stopped') {
        this.isPlaying = false;
        this.stopP5();
        this.radar.setFctSound(0);
      }
    },
    clamp: function (value) {
      return 0.0079 * value + 0.001; //return Math.min(max, Math.max(min, value));
    },

    convertSoundDuration(sec) {
      var val = (sec / 60).toFixed(2);
      return val.toString().replace(".", ":");
    }

  }
});
// CONCATENATED MODULE: ./pages/poster.vue?vue&type=script&lang=js&
 /* harmony default export */ var pages_postervue_type_script_lang_js_ = (postervue_type_script_lang_js_); 
// EXTERNAL MODULE: ./node_modules/vue-loader/lib/runtime/componentNormalizer.js
var componentNormalizer = __webpack_require__(2);

// CONCATENATED MODULE: ./pages/poster.vue



function injectStyles (context) {
  
  
}

/* normalize component */

var component = Object(componentNormalizer["a" /* default */])(
  pages_postervue_type_script_lang_js_,
  render,
  staticRenderFns,
  false,
  injectStyles,
  "a3967356",
  "4654d9d2"
  
)

/* harmony default export */ var poster = __webpack_exports__["default"] = (component.exports);

/***/ })

};;
//# sourceMappingURL=poster.js.map